---
深入学习mongodb
--- 

![](/images/mongodb.png)

# 关于分布式数据
[关于分布式数据库，你需要知道的一些事](https://juejin.im/entry/589abc01128fe10058fc542c)


## 什么是分片？ 
分片（sharding） 是MongoDB用来将大型集合分割到不同服务器（或者说一个集群）上所采用的方法。尽管分片起源于关系型数据库分区。但它（像mongodb）完全是两回事。 

## 让集群透明
mongodb 通过一个mongos的一个路由程序， 让跟mongo进行通信的客户端看起来只是一个mongod的实例。  
mongos 是一个路由进程， 位于mongo集群的最前方， 起到代理的作用， 负责把请求正确无误地转发到集群中的一个或一组服务器上，然后再把获得到响应信息发回给客户端。  


## 保证集群的可高用
任何时候， 我们都很难做到保证集群的永远可用性，不可抗力造成的情况，但是在合理条件下，永远都不应该出现用户无法读写数据的情况。 在功能发生明显降级前， 集群应当允许尽可能多的节点失败。  

mongoDB通过多种方法来确保集群的最长的正常运行时间。 集群的每一部分数据可以并且应当在其他服务器上（最理想的情况是在其他的数据中心） 有冗余的进程运行，以便当一个进程/机器/数据中心坏掉了， 其他副本可以立即（自动地）接替坏掉的部分继续工作。 

## 使集群易于扩展
当系统需要更多的空间或资源时， 应当可以添加。 mongoDB支持按需扩充系统容量。 

要实现这些目标，一个集群应该易于使用（就像使用单个节点一样） 和易于管理（否则添加新的分片就不那么容易了）。 MongoDB在扩容方面具有天然优势。 

<!-- more -->


# 理解分片

## 分割数据
分片（shard）是集群中负责数据某一子集的一台或多台服务器。一个分片可由多台服务器组成。 如果分片包含不止一台服务器， 则每台服务器都有一份完全相同的数据子集要的副本。 在一生产环境中，一个分片通常是一个副本集（replica set)。
![](/images/sharding1.png)

上图: 一个分片包含数据的某一子项。 若某一分片包含多台服务器，则每台服务器拥有一份完整的数据副本

为了在分片间均匀的分配数据，MongoDB会在不同的分片间移动数据子集。 它会根据片键（key）来决定移动哪些数据。 例如我们可能选择按用户名(username)字段来划分用户集合。 MongoDB使用基于区间的方法进行划分， 即按照给定区间将数据分割 成不同块。 




### 分配数据


### 平衡



